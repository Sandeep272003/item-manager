<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Item Manager ‚Äî Professional UI</title>
  <meta name="description" content="Simple Item Manager UI integrated with backend at items-manager-yvbd.onrender.com" />
  <style>
    :root{
      --bg: #f6f8fb;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #6c5ce7;
      --danger: #ef4444;
      --shadow: 0 8px 24px rgba(16,24,40,0.06);
      --radius: 12px;
      --max-width: 1100px;
      --gap: 18px;
      --font-sans: Inter, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font-sans);
      background:var(--bg);
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
    }
    .main-container{max-width:var(--max-width);margin:28px auto;padding:20px}
    .hero-card{display:flex;justify-content:space-between;align-items:center;gap:16px;padding:18px;border-radius:var(--radius);background:linear-gradient(180deg,#fff,#fbfdff);box-shadow:var(--shadow)}
    .hero-title{margin:0;font-size:1.5rem;font-weight:700}
    .hero-sub{margin:4px 0 0;color:var(--muted);font-size:.95rem}
    .grid-layout{display:grid;grid-template-columns:360px 1fr;gap:var(--gap);margin-top:18px}
    .glass, .glass-strong{background:var(--card);padding:16px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .glass-strong{padding:18px;background:linear-gradient(180deg,#fff,#f8fbff)}
    .form-group{position:relative;margin-bottom:12px}
    .floating-label{display:block;margin-bottom:6px;font-weight:600;font-size:.95rem}
    .input-large, textarea{width:100%;padding:.8rem;border-radius:10px;border:1px solid #e6e9ef;background:#fff;font-size:1rem;color:inherit}
    textarea{min-height:90px;resize:vertical}
    .row{display:flex;align-items:center}
    .cta{background:var(--accent);color:#fff;border:none;padding:.6rem .9rem;border-radius:10px;cursor:pointer;font-weight:600}
    .btn{background:#eef2ff;border:1px solid #e6e9ef;padding:.45rem .6rem;border-radius:8px;cursor:pointer}
    .btn.small{padding:.25rem .5rem;font-size:.9rem}
    .btn.danger,.danger{background:var(--danger);color:#fff;border:none}
    #itemsContainer{display:grid;gap:12px}
    .result-card,.item-card{padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fcfdff);display:flex;justify-content:space-between;align-items:center;border:1px solid #eef2f6}
    .item-meta h4{margin:0;font-size:1.05rem}
    .item-meta p{margin:.35rem 0 0;color:var(--muted);font-size:.95rem}
    .item-price{font-weight:800;color:var(--accent);font-size:1.05rem}
    .small{font-size:.85rem}
    .muted{color:var(--muted)}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);z-index:999}
    .modal.hidden{display:none}
    .modal-content{background:var(--card);padding:18px;border-radius:10px;max-width:520px;width:92%;box-shadow:0 20px 50px rgba(2,6,23,0.35);position:relative}
    .modal-close{position:absolute;right:14px;top:8px;background:none;border:none;font-size:1.4rem;cursor:pointer}
    #app-toast{transition:opacity .28s ease}
    body.light-mode{--bg:#ffffff;--card:#ffffff;--muted:#475569;--accent:#4f46e5}
    @media (max-width: 900px){.grid-layout{grid-template-columns:1fr}.hero-card{flex-direction:column;align-items:flex-start}.main-container{padding:14px}}
    .hidden{display:none}
    .icon-btn{background:transparent;border:1px solid transparent;padding:.4rem;border-radius:8px;cursor:pointer}
    .toggle-switch{width:44px;height:26px;background:#eef2f6;border-radius:999px;display:inline-flex;align-items:center;padding:3px;cursor:pointer}
    .toggle-knob{width:20px;height:20px;background:#fff;border-radius:50%;box-shadow:0 4px 10px rgba(2,6,23,0.12);transform:translateX(0);transition:transform .18s ease}
    body.light-mode .toggle-knob{transform:translateX(18px)}
    /* small helpers */
    .focus-halo{position:absolute;inset:0;border-radius:8px;pointer-events:none}
  </style>
</head>
<body class="page" id="root">
  <div class="main-container">
    <header class="hero-card" role="banner">
      <div>
        <h1 class="hero-title">Item Manager</h1>
        <p class="hero-sub">Create, browse and manage items ‚Äî search, sort, pagination, and details.</p>
      </div>

      <div class="row" style="gap:1rem;align-items:center">
        <div class="glass" id="themeToggleWrap" style="display:flex;align-items:center;gap:.75rem">
          <button id="lightBtn" class="icon-btn" title="Light mode" aria-label="Light mode">‚òÄÔ∏è</button>
          <div class="toggle-switch" id="themeSwitch" role="switch" aria-checked="false" tabindex="0" aria-label="Toggle theme">
            <div class="toggle-knob" id="toggleKnob"></div>
          </div>
          <button id="darkBtn" class="icon-btn" title="Dark mode" aria-label="Dark mode">üåô</button>
        </div>

        <button class="cta" id="openAdd">Add Item</button>
      </div>
    </header>

    <div class="grid-layout" role="main">
      <section class="glass-strong" id="formPanel" aria-labelledby="formTitle">
        <h2 id="formTitle">Add / Edit Item</h2>

        <form id="itemForm" novalidate>
          <input type="hidden" id="itemId" />

          <div class="form-group">
            <label class="floating-label" for="name">Name</label>
            <input id="name" class="input-large" placeholder="Item name" maxlength="120" required />
            <div class="focus-halo"></div>
          </div>

          <div class="form-group">
            <label class="floating-label" for="description">Description</label>
            <textarea id="description" class="input-large" placeholder="Short description" maxlength="1000" required></textarea>
            <div class="focus-halo"></div>
          </div>

          <div class="form-group">
            <label class="floating-label" for="price">Price</label>
            <input id="price" class="input-large" type="number" step="0.01" min="0" placeholder="0.00" required />
            <div class="focus-halo"></div>
          </div>

          <div class="row" style="justify-content:flex-end;margin-top:0.5rem">
            <button type="button" id="resetBtn" class="btn">Reset</button>
            <button type="submit" id="submitBtn" class="cta">Save Item</button>
          </div>
        </form>
      </section>

      <section class="glass" id="listPanel" aria-labelledby="listTitle">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div>
            <h3 id="listTitle" style="margin:0">Items</h3>
            <p class="small muted" style="margin:6px 0 0">Search, sort and browse items</p>
          </div>

          <div class="row">
            <input id="searchInput" class="input-large" placeholder="Search items..." style="width:220px;padding:.75rem" />
            <select id="sortSelect" class="input-large" style="width:160px;padding:.6rem">
              <option value="">Sort By</option>
              <option value="name,asc">Name A ‚Üí Z</option>
              <option value="name,desc">Name Z ‚Üí A</option>
              <option value="price,asc">Price Low ‚Üí High</option>
              <option value="price,desc">Price High ‚Üí Low</option>
              <option value="createdAt,desc">Newest</option>
            </select>
          </div>
        </div>

        <div id="itemsContainer" style="margin-top:1rem;display:grid;gap:12px" aria-live="polite"></div>

        <div class="row" style="justify-content:center;margin-top:1rem">
          <button id="prevPage" class="btn">Prev</button>
          <div id="pageInfo" class="small muted" style="padding:0 .75rem">Page 1</div>
          <button id="nextPage" class="btn">Next</button>
        </div>
      </section>
    </div>

    <footer style="text-align:center;color:var(--muted);font-size:.95rem;padding-top:1rem">
      Built with care ‚Ä¢ JSON persistence ‚Ä¢ Responsive UI
    </footer>
  </div>

  <div id="detailModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content">
      <button class="modal-close" id="closeModal" aria-label="Close">&times;</button>
      <h3 id="detailName"></h3>
      <p id="detailDesc"></p>
      <p><strong>Price</strong>: ‚Çπ<span id="detailPrice"></span></p>
      <p><small>Created: <span id="detailCreated"></span></small></p>
      <div class="modal-actions" style="margin-top:12px;display:flex;gap:.5rem;justify-content:flex-end">
        <button id="editBtn" class="btn">Edit</button>
        <button id="deleteBtn" class="btn danger">Delete</button>
      </div>
    </div>
  </div>

  <script>
    // Direct backend URL (Render)
    const apiBase = 'https://items-manager-yvbd.onrender.com/api/items';

    // state
    let page = 0, size = 10, sort = '', q = '';

    /* Theme toggle */
    const themeSwitch = document.getElementById('themeSwitch');
    const lightBtn = document.getElementById('lightBtn');
    const darkBtn = document.getElementById('darkBtn');

    function applyTheme(isLight) {
      if (isLight) {
        document.body.classList.add('light-mode');
        themeSwitch?.setAttribute('aria-checked', 'true');
        localStorage.setItem('theme', 'light');
      } else {
        document.body.classList.remove('light-mode');
        themeSwitch?.setAttribute('aria-checked', 'false');
        localStorage.setItem('theme', 'dark');
      }
    }

    (function initTheme() {
      const saved = localStorage.getItem('theme');
      if (saved === 'light') applyTheme(true);
      else if (saved === 'dark') applyTheme(false);
      else {
        const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
        applyTheme(prefersLight);
      }
    })();

    themeSwitch?.addEventListener('click', () => applyTheme(!document.body.classList.contains('light-mode')));
    themeSwitch?.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); themeSwitch.click(); }});
    lightBtn?.addEventListener('click', () => applyTheme(true));
    darkBtn?.addEventListener('click', () => applyTheme(false));

    /* App init */
    document.addEventListener('DOMContentLoaded', () => {
      bindForm();
      bindControls();
      loadItems();
    });

    /* Form handling */
    function bindForm() {
      const form = document.getElementById('itemForm');
      const resetBtn = document.getElementById('resetBtn');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        await submitForm();
      });

      resetBtn.addEventListener('click', resetForm);
    }

    async function submitForm() {
      const id = document.getElementById('itemId').value || null;
      const name = document.getElementById('name').value.trim();
      const description = document.getElementById('description').value.trim();
      const priceRaw = document.getElementById('price').value;
      const price = priceRaw === '' ? 0 : parseFloat(priceRaw);

      if (!name || !description || isNaN(price) || price < 0) {
        showToast('Please provide valid name, description and non-negative price.');
        return;
      }

      const payload = { name, description, price };

      try {
        let res;
        if (id) {
          res = await fetch(`${apiBase}/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
        } else {
          res = await fetch(apiBase, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
        }

        if (!res.ok) {
          const text = await res.text();
          showToast('Failed: ' + (text || res.statusText));
          return;
        }

        resetForm();
        page = 0;
        loadItems();
        showToast(id ? 'Item updated' : 'Item added');
      } catch (err) {
        console.error(err);
        showToast('Network error');
      }
    }

    function resetForm() {
      document.getElementById('itemForm').reset();
      document.getElementById('itemId').value = '';
      document.getElementById('submitBtn').textContent = 'Save Item';
    }

    /* Controls */
    function bindControls() {
      const searchInput = document.getElementById('searchInput');
      const sortSelect = document.getElementById('sortSelect');

      searchInput?.addEventListener('input', (e) => {
        q = e.target.value.trim();
        page = 0;
        debounceLoad();
      });

      sortSelect?.addEventListener('change', (e) => {
        sort = e.target.value;
        page = 0;
        loadItems();
      });

      document.getElementById('prevPage').addEventListener('click', () => { if (page > 0) { page--; loadItems(); }});
      document.getElementById('nextPage').addEventListener('click', () => { page++; loadItems(); });

      document.getElementById('openAdd').addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
        resetForm();
        document.getElementById('name').focus();
      });
    }

    /* Debounce */
    let debounceTimer = null;
    function debounceLoad() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => loadItems(), 300);
    }

    /* Load items */
    async function loadItems() {
      const params = new URLSearchParams();
      if (q) params.append('q', q);
      params.append('page', page);
      params.append('size', size);
      if (sort) params.append('sort', sort);

      const container = document.getElementById('itemsContainer');
      container.innerHTML = '<div class="muted">Loading...</div>';

      try {
        const res = await fetch(`${apiBase}?${params.toString()}`);
        if (!res.ok) throw new Error('Failed to fetch items');
        const data = await res.json();

        // Support both array and paged object
        let items = [];
        let total = 0;
        if (Array.isArray(data)) {
          items = data;
          total = data.length;
        } else {
          items = data.items || data.content || [];
          total = data.total ?? data.totalElements ?? items.length;
          page = data.page ?? page;
          size = data.size ?? size;
        }

        renderItems(items);
        updatePageInfo(page, size, total);
      } catch (err) {
        console.error(err);
        container.innerHTML = `<div class="muted">Error loading items: ${escapeHtml(err.message || 'Unknown')}</div>`;
      }
    }

    /* Render list */
    function renderItems(items) {
      const container = document.getElementById('itemsContainer');
      container.innerHTML = '';
      if (!items || items.length === 0) {
        container.innerHTML = `<div class="result-card"><div class="item-meta"><h4>No items found</h4><p class="muted">Try adding a new item or change search filters.</p></div></div>`;
        return;
      }
      items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'result-card';
        card.innerHTML = `
          <div class="item-meta">
            <h4>${escapeHtml(item.name)}</h4>
            <p>${escapeHtml(truncate(item.description, 160))}</p>
          </div>
          <div style="display:flex;align-items:center;gap:12px">
            <div style="text-align:right">
              <div style="font-weight:800;font-size:1.05rem">‚Çπ${(item.price ?? 0).toFixed(2)}</div>
              <div class="small muted">${formatInstant(item.createdAt || Date.now())}</div>
            </div>
            <div>
              <button class="btn" onclick="showDetails(${item.id})">Details</button>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    /* Pagination info */
    function updatePageInfo(p, s, total) {
      const pageInfo = document.getElementById('pageInfo');
      const from = total ? (p * s + 1) : 0;
      const to = Math.min((p + 1) * s, total);
      pageInfo.textContent = `Showing ${total ? from : 0} - ${to} of ${total} (Page ${p + 1})`;
      document.getElementById('prevPage').disabled = p <= 0;
      document.getElementById('nextPage').disabled = to >= total;
    }

    /* Details modal */
    const detailModal = document.getElementById('detailModal');
    const closeModalBtn = document.getElementById('closeModal');
    if (closeModalBtn) closeModalBtn.addEventListener('click', () => hideModal());

    async function showDetails(id) {
      try {
        const res = await fetch(`${apiBase}/${id}`);
        if (!res.ok) { showToast('Item not found'); return; }
        const item = await res.json();
        document.getElementById('detailName').textContent = item.name;
        document.getElementById('detailDesc').textContent = item.description;
        document.getElementById('detailPrice').textContent = (item.price ?? 0).toFixed(2);
        document.getElementById('detailCreated').textContent = formatInstant(item.createdAt || Date.now());

        document.getElementById('editBtn').onclick = () => openEdit(item);
        document.getElementById('deleteBtn').onclick = () => confirmDelete(item.id);

        showModal();
      } catch (err) {
        console.error(err);
        showToast('Failed to load details');
      }
    }

    function showModal() {
      if (!detailModal) return;
      detailModal.classList.remove('hidden');
      detailModal.setAttribute('aria-hidden', 'false');
    }

    function hideModal() {
      if (!detailModal) return;
      detailModal.classList.add('hidden');
      detailModal.setAttribute('aria-hidden', 'true');
    }

    /* Edit flow */
    function openEdit(item) {
      hideModal();
      document.getElementById('itemId').value = item.id;
      document.getElementById('name').value = item.name;
      document.getElementById('description').value = item.description;
      document.getElementById('price').value = item.price ?? 0;
      document.getElementById('submitBtn').textContent = 'Update Item';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    /* Delete flow */
    async function confirmDelete(id) {
      if (!confirm('Delete this item permanently?')) return;
      try {
        const res = await fetch(`${apiBase}/${id}`, { method: 'DELETE' });
        if (res.status === 204 || res.ok) {
          showToast('Deleted');
          hideModal();
          loadItems();
        } else {
          showToast('Failed to delete');
        }
      } catch (err) {
        console.error(err);
        showToast('Network error');
      }
    }

    /* Helpers */
    function truncate(str, n) {
      if (!str) return '';
      return str.length > n ? str.slice(0, n - 1) + '‚Ä¶' : str;
    }

    function escapeHtml(unsafe) {
      if (!unsafe) return '';
      return String(unsafe).replace(/[&<"'>]/g, function (m) {
        return ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' })[m];
      });
    }

    /* Toast */
    let toastTimer = null;
    function showToast(msg) {
      if (!document.body) { alert(msg); return; }
      let toast = document.getElementById('app-toast');
      if (!toast) {
        toast = document.createElement('div');
        toast.id = 'app-toast';
        toast.style.position = 'fixed';
        toast.style.right = '20px';
        toast.style.bottom = '20px';
        toast.style.background = 'rgba(15,23,42,0.92)';
        toast.style.color = '#fff';
        toast.style.padding = '12px 16px';
        toast.style.borderRadius = '10px';
        toast.style.boxShadow = '0 10px 30px rgba(2,6,23,0.6)';
        toast.style.zIndex = 9999;
        toast.style.transition = 'opacity .28s ease';
        document.body.appendChild(toast);
      }
      toast.textContent = msg;
      toast.style.opacity = '1';
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => { toast.style.opacity = '0'; }, 3000);
    }

    /* Utilities */
    function formatInstant(v) {
      if (!v) return '';
      const n = Number(v);
      let d;
      if (!isNaN(n) && String(v).length >= 10) {
        d = new Date(n > 1e12 ? n : n * 1000);
      } else {
        d = new Date(v);
      }
      if (isNaN(d)) return v;
      return d.toLocaleString();
    }

    /* Keyboard: close modal on Esc */
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const modal = document.getElementById('detailModal');
        if (modal && !modal.classList.contains('hidden')) modal.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
